<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beta Program | Form</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="form-container">        
        <div class="container">
            <form action="">
                <div class="logo">
                    <img src="assests/logo.png" alt="logo">
                </div>
                <h1>AH Saiful Story Link</h1>
                <h2>Admin & Moderator Info</h2>
                <br>
                <br>
                <h3>Please fill the form</h3>
                <br>
                <br>
                <label for="name-en">Name (English)</label>
                <input type="text" id="name-en" placeholder="Enter Your Name in English" required>                
                <label for="name-bn">Name (Bangla)</label>
                <input type="text" id="name-bn" placeholder="আপনার নাম বাংলায় লিখুন" required>
                <label for="dob">Date of Birth</label>
                <input type="date" name="" id="dob" placeholder="" required> 
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="Enter Your Email" required>
                <label for="fblink">Facebook ID link</label>
                <input type="text" id="fblink" placeholder="Enter Your Facebook ID Link" required>
                <label for="phone">Phone</label>                
                <div class="form-row">
                    <select name="" id="p-code">
                        <option>+880</option>                   
                    </select>
                    <input type="text" id="phone">
                </div>
                <!-- <label for="subDate">Form Submit Date</label>
                <input type="date" id="subDate" placeholder="" required> -->
                <br>                       
                <br>
                <div class="button">
                    <input type="submit" value="Submit" class="color-green btn">                
                    <input type="reset" value="Reset" class="color-red btn">
                </div>
                <div class="footer">
                    <p>&copy; AH Saiful Story Link | All Right Reserved 2026</p>
                    <p>Powered by <a href="https://www.facebook.com/dark.hunter.back" target="_blank">Golpo Reader</a></p>
                </div>                      
            </form>                
        </div>               
    </div>
    <script>
        document.querySelector("form").addEventListener("submit", function(e){
            e.preventDefault();

            const submitBtn = document.querySelector(".color-green");
            submitBtn.disabled = true;                 // বাটন নিষ্ক্রিয় করা
            submitBtn.value = "Submitting... ⏳";      // টেক্সট পরিবর্তন

            // Dhaka টাইম অনুযায়ী সাবমিট তারিখ বের করা
            const now = new Date();
            const optionsDate = { timeZone: "Asia/Dhaka", year: "numeric", month: "2-digit", day: "2-digit" };
            const subDate = new Intl.DateTimeFormat("en-GB", optionsDate).format(now);

            // ফর্মের ইনপুট ভ্যালু সংগ্রহ
            const formData = {
                nameEn: document.getElementById("name-en").value,
                nameBn: document.getElementById("name-bn").value,
                dob: document.getElementById("dob").value,
                email: document.getElementById("email").value,
                fblink: document.getElementById("fblink").value,
                phone: document.getElementById("phone").value,
                subDate: subDate
            };

            // প্রথমে শিটের ডাটা নিয়ে আসা
            fetch("https://script.google.com/macros/s/AKfycbz7pBK48OeLtIlUSP7BTYkHqtgtr58PtpIRzz6TtQygLJtF57egW4GKfxhzSTRu3nFm/exec")
                .then(res => res.json())
                .then(data => {
                    let duplicate = false;
                    let conflictField = "";

                    data.forEach(row => {
                        const [nameEn, nameBn, dob, email, fblink, phone, subDate] = row;

                        if (formData.email === email) {
                            duplicate = true;
                            conflictField = "Email";
                        }
                        if (formData.phone === phone) {
                            duplicate = true;
                            conflictField = "Phone";
                        }
                        if (formData.fblink === fblink) {
                            duplicate = true;
                            conflictField = "Facebook Link";
                        }
                    });

                    if (duplicate) {
                        alert(conflictField + " আগে থেকেই আছে, অনুগ্রহ করে অন্য তথ্য দিন।");
                        submitBtn.disabled = false;        // আবার সক্রিয় করা
                        submitBtn.value = "Submit";        // টেক্সট আগের মতো করা
                    } else {
                        fetch("https://script.google.com/macros/s/AKfycbz7pBK48OeLtIlUSP7BTYkHqtgtr58PtpIRzz6TtQygLJtF57egW4GKfxhzSTRu3nFm/exec", {
                            method: "POST",
                            body: JSON.stringify(formData)
                        })
                        .then(res => res.text())
                        .then(data => {
                            window.location.href = "successful.html"; 
                        })
                        .catch(err => {
                            alert("Something went wrong: " + err);
                            submitBtn.disabled = false;
                            submitBtn.value = "Submit";
                        });
                    }
                })
                .catch(err => {
                    alert("Error checking duplicates: " + err);
                    submitBtn.disabled = false;
                    submitBtn.value = "Submit";
                });
        });
    </script>
</body>
</html>